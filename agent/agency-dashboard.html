<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agency Dashboard</title>
    <link rel="stylesheet" href="./css/agent.css" />
    <script defer src="./js/agent.js"></script>
  </head>
  <body>
    <div class="sidebar">
      <div>
        <div class="logo">Agency Dashboard</div>
        <ul class="menu">
          <li class="active">Dashboard</li>
          <li>Notifications</li>
          <li>Validate Report</li>
          <li>Investigations</li>
          <li>Follow-Up</li>
          <li>Settings</li>
        </ul>
      </div>
      <a id="logout">logout</a>
    </div>

    <div class="main-content">
      <header class="header">
        <h1>Agency Overview</h1>
        <div class="profile">
          <div class="image-cont"></div>
          <!-- <img src="https://via.placeholder.com/50" alt="Admin Profile" /> -->
          <span>Welcome, Admin</span>
        </div>
      </header>

      <div class="dashboard-cards">
        <div class="card">
          <h2>New Report Notifications</h2>
          <p>You have <strong>8</strong> new incident reports.</p>
          <button onclick="viewReports()">View Reports</button>
        </div>

        <div class="card">
          <h2>Validate Reports</h2>
          <p>Reports pending validation: <strong>4</strong></p>
          <button onclick="validateReports()">Validate Now</button>
        </div>

        <div class="card">
          <h2>Initiate Investigation</h2>
          <p>Investigations in progress: <strong>3</strong></p>
          <button onclick="initiateInvestigation()">Start Investigation</button>
        </div>

        <div class="card">
          <h2>Follow-Up Incidents</h2>
          <p>Pending follow-ups: <strong>5</strong></p>
          <button onclick="followUp()">Manage Follow-Ups</button>
        </div>
      </div>

      <footer class="footer">
        <p>Agency Dashboard Â© 2024</p>
      </footer>
    </div>
    <script type="module">
      import { auth, db } from "../js/firebaseConfig.js";
      import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
      import {
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            const role = userData.userType;

            if (role !== "agency") {
              alert("Access Denied");
              window.location.href = "/login.html";
            }
          } else {
            alert("User data not found");
            window.location.href = "/login.html";
          }
        } else {
          // No user is signed in
          alert("You must be logged in to access this");
          window.location.href = "/login.html";
        }
      });
    </script>
    <script type="module">
      import { auth } from "../js/firebaseConfig.js";
      import { signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
      const logout = document.getElementById("logout");
      logout.addEventListener("click", async function (e) {
        e.preventDefault();
        try {
          const signout = await signOut(auth);
          alert("Logged out successfully!");
          window.location.href = "/";
        } catch (error) {
          alert(error.message);
        }
      });

      // JavaScript to handle dynamic data and interaction

      // Example: Simulate fetching report counts
      document.addEventListener("DOMContentLoaded", () => {
        const totalReports = document.getElementById("total-reports");
        const pendingCases = document.getElementById("pending-cases");
        const resolvedCases = document.getElementById("resolved-cases");

        // Simulated data
        const data = {
          total: 12,
          pending: 5,
          resolved: 7,
        };

        // Update statistics
        totalReports.textContent = data.total;
        pendingCases.textContent = data.pending;
        resolvedCases.textContent = data.resolved;
      });

      // Example: Add notification dynamically
      const notificationList = document.getElementById("notification-list");
      notificationList.insertAdjacentHTML(
        "beforeend",
        "<li>New report submitted successfully!</li>"
      );
    </script>
  </body>
</html>
